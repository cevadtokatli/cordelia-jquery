/**
 *   Cordelia color picker
 *   version: 1.0.0
 *    author: Cevad Tokatli <cevadtokatli@hotmail.com>
 *   website: http://cevadtokatli.com
 *    github: https://github.com/cevadtokatli/cordelia-jquery
 *   license: MIT
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(t){"use strict";function i(i){var e=r(i),o=document.createElement("div");t(i).attr("id")&&t(o).attr("id",t(i).attr("id")),t(i).replaceWith(o),new s(o,e)}function e(i){t(i).removeAttr("cordelia"),new s(i,r(i))}function r(i){for(var e=i.attributes,r={},o=0;o<e.length;o++){var s=e[o];if(s.name.indexOf("cordelia-")>-1){for(var a=s.name.replace("cordelia-","");a.indexOf("-")>-1;){var c=a.indexOf("-");a[c+1]&&(a=a.substring(0,c)+a[c+1].toUpperCase()+a.substring(c+2,a.length))}if(void 0!==n[a]){var l=s.value;"true"==l?l=!0:"false"==l&&(l=!1),"paletteColors"==a&&(l=l.split(",")),r[a]=l}t(i).removeAttr(s.name),o-=1}}return r}function o(t){var i=document.createEvent("HTMLEvents")||document.createEvent("event");return i.initEvent(t,!1,!0),i}function s(i,e){this.elm={},this.elm.main=t(i),this.extractAttributes(e),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&!this.embed?this.size="small":"small"!=this.size&&"large"!=this.size&&(this.size="medium"),this.majorPicker={},this.minorPicker={},this.opacityPicker={},"small"==this.size?(this.majorPicker.width=125,this.majorPicker.height=125,this.minorPicker.width=20,this.minorPicker.height=125):"medium"==this.size?(this.majorPicker.width=175,this.majorPicker.height=175,this.minorPicker.width=30,this.minorPicker.height=175):(this.majorPicker.width=250,this.majorPicker.height=250,this.minorPicker.width=30,this.minorPicker.height=250),this.majorPicker.subtractedValue=9,this.minorPicker.subtractedValue=7,this.allowOpacity&&(this.opacityPicker.width=this.minorPicker.width,this.opacityPicker.height=this.minorPicker.height,this.opacityPicker.subtractedValue=this.minorPicker.subtractedValue),0!=this.pickerStyle&&(this.pickerStyle=1),"rgb"!=this.colorFormat&&"rgba"!=this.colorFormat&&"hsl"!=this.colorFormat&&"hsla"!=this.colorFormat&&(this.colorFormat="hex"),this.color||(this.allowClearColor?this.color=null:"hex"==this.colorFormat?this.color="#FF000":"rgb"==this.colorFormat?this.color="rgb(255,0,0)":"rgba"==this.colorFormat?this.color="rgba(255,0,0,1)":"hsl"==this.colorFormat?this.color="hsl(0,100%,50%)":"hsla"==this.colorFormat&&(this.color="hsla(0,100%,50%,1)")),this.init(),h.push(this)}function a(t,i){var e=i.container.offset(),r=t.clientX?t.clientX+window.pageXOffset:t.pageX,o=t.clientY?t.clientY+window.pageYOffset:t.pageY,s=r-(e.left+i.subtractedValue),a=o-(e.top+i.subtractedValue);return s<-i.subtractedValue?s=-i.subtractedValue:s>i.width-i.subtractedValue&&(s=i.width-i.subtractedValue),a<-i.subtractedValue?a=-i.subtractedValue:a>i.height-i.subtractedValue&&(a=i.height-i.subtractedValue),i.dragger.css("left",s+"px"),i.dragger.css("top",a+"px"),{x:s+i.subtractedValue,y:a+i.subtractedValue}}function c(t){return Math.round((299*t.r+587*t.g+114*t.b)/1e3)>125}var l={open:o("open"),close:o("close"),save:o("save"),cancel:o("cancel"),changed:o("changed")},n={size:"medium",embed:!0,pickerStyle:0,allowOpacity:!0,allowClearColor:!1,showColorValue:!0,colorFormat:"hex",color:"#FF0000",showButtons:!0,showPalette:!0,paletteColors:["#FFFFB5","#FBBD87","#F45151","#7AEA89","#91C8E7","#8EB4E6","#B0A7F1"],allowPaletteAddColor:!0},h=[];t.fn.cordelia=function(t,i){var e;return this.each(function(r){if("string"!=typeof t)new s(this,t);else{var o=h.filter(function(t){return t.elm.main[0]==this?t:null}.bind(this));if(0==o.length)throw new Error("Element could not be found");if(o=o[0],"get"==t)e=o.get();else if("set"==t)o.set(i);else if("show"==t)o.show();else if("hide"==t)o.hide();else if("save"==t)o.save();else{if("cancel"!=t)throw new Error("Method could not be found");o.cancel()}}}),e},addEventListener("load",function(){for(var t=document.querySelectorAll("cordelia"),r=0;r<t.length;r++)i(t[r]);for(var o=document.querySelectorAll("*[cordelia]"),r=0;r<o.length;r++)e(o[r])});var d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;d&&new d(function(t){t.forEach(function(t){if("attributes"==t.type){var r=t.target;r.getAttribute("cordelia")&&e(r)}else for(var o=0;o<t.addedNodes.length;o++)!function(r){var o=t.addedNodes[r];-1==o.nodeName.indexOf("#")&&("CORDELIA"==o.nodeName?i(o):o.getAttribute("cordelia")&&e(o))}(o)})}).observe(document,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),s.prototype.extractAttributes=function(t){for(var i in n)void 0!==t[i]?this[i]=t[i]:this[i]=n[i]},s.prototype.init=function(){if(this.pickerMovedBind=this.pickerMoved.bind(this),this.pickerReleasedBind=this.pickerReleased.bind(this),this.closePickerBind=this.closePicker.bind(this),this.setPositionBind=this.setPosition.bind(this),this.embed?this.elm.picker=this.elm.main:(this.elm.main.addClass("cdp-wrapper"),this.elm.main.addClass("cdp-background-type-opacity"),this.elm.main.bind("click",this.openPicker.bind(this)),this.elm.overlay=t(document.createElement("div")),this.elm.overlay.addClass("cdp-wrapper-overlay"),this.elm.main.append(this.elm.overlay),this.elm.picker=t(document.createElement("div")),this.elm.picker.css("display","none"),this.elm.overlay.append(this.elm.picker)),this.elm.picker.addClass("cdp-container"),this.elm.picker.attr("cdp-size",this.size),this.elm.rgbaColor=t(document.createElement("div")),this.elm.rgbaColor.addClass("cdp-hidden"),this.elm.picker.append(this.elm.rgbaColor),this.rgbaColor={},this.rgbaColor.a=1,this.rgbColor={},this.hslColor={},this.color){var i=this.getRgbaValue(this.color),e=this.convertColor(i).value;this.color=e,this.rgbaColor=i}this.initialColor=e;var r=t(document.createElement("div"));if(r.addClass("cdp-picker-container"),this.elm.picker.append(r),this.majorPicker.container=t(document.createElement("div")),this.majorPicker.container.addClass("cdp-major-picker"),r.append(this.majorPicker.container),this.minorPicker.container=t(document.createElement("div")),this.minorPicker.container.addClass("cdp-minor-picker"),r.append(this.minorPicker.container),0==this.pickerStyle?(this.majorPicker.container.html('<div class="cdp-major-picker-gradient cdp-background-type-current-color"><div class="cdp-major-picker-gradient cdp-gradient-type-lr-white"><div class="cdp-major-picker-gradient cdp-gradient-type-bt-black cdp-last-gradient-child"></div></div></div>'),this.elm.pickerCurrentColorBackground=this.majorPicker.container.find(".cdp-background-type-current-color"),this.minorPicker.container.html('<div class="cdp-minor-picker-gradient cdp-gradient-type-tb-colorful cdp-last-gradient-child"></div>')):1==this.pickerStyle&&(this.majorPicker.container.html('<div class="cdp-major-picker-gradient cdp-gradient-type-lr-colorful"><div class="cdp-major-picker-gradient cdp-gradient-type-bt-gray cdp-last-gradient-child"></div></div>'),this.minorPicker.container.html('<div class="cdp-minor-picker-gradient cdp-gradient-type-bt-white-current-color-black cdp-last-gradient-child"></div>'),this.elm.pickerCurrentColorBackground=this.minorPicker.container.find(".cdp-gradient-type-bt-white-current-color-black")),this.majorPicker.dragger=t(document.createElement("div")),this.majorPicker.dragger.addClass("cdp-major-dragger"),this.majorPicker.container.find(".cdp-last-gradient-child").append(this.majorPicker.dragger),this.majorPicker.container.bind("mousedown",function(t){this.pickerClicked(t,"major")}.bind(this)),this.majorPicker.container.bind("touchstart",function(t){this.pickerClicked(t,"major")}.bind(this)),this.minorPicker.dragger=t(document.createElement("div")),this.minorPicker.dragger.addClass("cdp-minor-dragger"),this.minorPicker.container.find(".cdp-last-gradient-child").append(this.minorPicker.dragger),this.minorPicker.container.bind("mousedown",function(t){this.pickerClicked(t,"minor")}.bind(this)),this.minorPicker.container.bind("touchstart",function(t){this.pickerClicked(t,"minor")}.bind(this)),this.allowOpacity&&(this.opacityPicker.container=t(document.createElement("div")),this.opacityPicker.container.addClass("cdp-opacity-picker"),this.opacityPicker.container.html('<div class="cdp-opacity-picker-gradient cdp-background-type-opacity"><div class="cdp-opacity-picker-gradient cdp-gradient-type-bt-current-color cdp-last-gradient-child"><div class="cdp-opacity-dragger"></div></div></div>'),r.append(this.opacityPicker.container),this.elm.pickerCurrentColorOpacityBackground=this.opacityPicker.container.find(".cdp-gradient-type-bt-current-color"),this.opacityPicker.dragger=this.opacityPicker.container.find(".cdp-opacity-dragger"),this.opacityPicker.container.bind("mousedown",function(t){this.pickerClicked(t,"opacity")}.bind(this)),this.opacityPicker.container.bind("touchstart",function(t){this.pickerClicked(t,"opacity")}.bind(this))),this.allowClearColor||this.showColorValue||this.showButtons){var o=t(document.createElement("div"));if(o.addClass("cdp-console-container"),this.elm.picker.append(o),this.allowClearColor||this.showColorValue){var s=t(document.createElement("div"));s.addClass("cdp-color-console-container"),s.addClass("cdp-background-type-opacity"),o.append(s),this.elm.currentColorConsole=t(document.createElement("div")),this.elm.currentColorConsole.addClass("cdp-current-color-console"),s.append(this.elm.currentColorConsole),this.showColorValue?(this.elm.initialColor=t(document.createElement("div")),this.elm.initialColor.addClass("cdp-initial-color"),this.elm.initialColor.html('<i class="cdp-icons"></i>'),this.elm.initialColor.bind("click",this.setColorWithInitialColor.bind(this)),this.elm.currentColorConsole.before(this.elm.initialColor),this.elm.colorValueInput=t(document.createElement("input")),this.elm.colorValueInput.addClass("cdp-current-color"),this.elm.colorValueInput.attr("type","text"),this.elm.colorValueInput.attr("spellcheck",!1),this.elm.colorValueInput.bind("change",function(){this.setColorWithValue()}.bind(this)),this.elm.currentColorConsole.append(this.elm.colorValueInput),this.elm.colorValueInput.value=this.color,this.setInitialColorIcon()):o.addClass("cdp-current-color-non-showing"),this.allowClearColor?(this.elm.clearColor=t(document.createElement("div")),this.elm.clearColor.addClass("cdp-clear-color"),this.elm.clearColor.html('<i class="cdp-icons"></i>'),this.elm.clearColor.bind("click",function(){this.clearColor()}.bind(this)),this.elm.currentColorConsole.append(this.elm.clearColor)):o.addClass("cdp-clear-color-non-showing")}else o.addClass("cdp-color-console-non-showing");if(this.showButtons){var a=t(document.createElement("div"));a.addClass("cdp-button-container"),a.html('<div class="cdp-button" cdp-function="save"><i class="cdp-icons"></i>SAVE</div><div class="cdp-button" cdp-function="cancel"><i class="cdp-icons"></i>CANCEL</div>'),o.append(a);var c=a.find('div[cdp-function="save"]'),l=a.find('div[cdp-function="cancel"]');c.bind("click",this.save.bind(this)),l.bind("click",this.cancel.bind(this))}}if(this.showPalette){var n=t(document.createElement("div"));n.addClass("cdp-arrow-div"),this.elm.picker.append(n);var h=t(document.createElement("i"));if(h.addClass("cdp-icons"),h.bind("click",function(){this.elm.paletteContainer.fadeToggle(100)}.bind(this)),n.append(h),this.elm.paletteContainer=t(document.createElement("div")),this.elm.paletteContainer.css("display","none"),this.elm.paletteContainer.html('<hr class="cdp-palette-line" /><div class="cdp-palette"></div>'),this.elm.picker.append(this.elm.paletteContainer),this.elm.palette=this.elm.picker.find(".cdp-palette"),this.allowPaletteAddColor){var d=t(document.createElement("div"));d.addClass("cdp-palette-add-element"),d.html('<i class="cdp-icons"></i>'),d.bind("click",this.addColorToPalette.bind(this)),this.elm.palette.append(d)}for(var p=0;p<this.paletteColors.length;p++)!function(t,i){var e=i.getRgbaValue(i.paletteColors[t]);i.paletteColors[t]="rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")",i.addColorElementToPalette(e)}(p,this)}this.color?this.setColor(null,!1,!0,!0):this.clearColor(!0)},s.prototype.setColor=function(t,i,e,r){var o,s;if(t&&(o=this.convertColor(t),this.rgbaColor=t),o&&o.value!=this.color||!t){if(t?this.color=o.value:t=this.rgbaColor,s=c(t),this.embed||this.elm.overlay.css("background",this.color),this.elm.currentColorConsole&&this.elm.currentColorConsole.css("background",this.color),s?0==this.pickerStyle?this.majorPicker.dragger.addClass("cdp-dark"):1==this.pickerStyle&&this.minorPicker.dragger.addClass("cdp-dark"):0==this.pickerStyle?this.majorPicker.dragger.removeClass("cdp-dark"):1==this.pickerStyle&&this.minorPicker.dragger.removeClass("cdp-dark"),this.allowOpacity&&(s||t.a<.25?this.opacityPicker.dragger.addClass("cdp-dark"):this.opacityPicker.dragger.removeClass("cdp-dark")),this.showColorValue&&(e&&this.elm.colorValueInput.val(this.color),s||t.a<.4?this.elm.colorValueInput.addClass("cdp-dark"):this.elm.colorValueInput.removeClass("cdp-dark")),this.elm.clearColor&&(s||t.a<.4?this.elm.clearColor.addClass("cdp-dark"):this.elm.clearColor.removeClass("cdp-dark")),r){var a=p.rgbTohsl(t);if(0==this.pickerStyle){this.elm.pickerCurrentColorBackground.css("background","hsl("+a.h+", 100%, 50%");var n=this.majorPicker.height,h=Math.max(t.r,t.g,t.b),d=Math.abs(Math.round(n/255*h-n)),u=Math.min(t.r,t.g,t.b),m=Math.abs(Math.round(n/255*u-n))-Math.abs(Math.round(d/h*u));this.majorPicker.dragger.css("left",m-this.majorPicker.subtractedValue+"px"),this.majorPicker.dragger.css("top",d-this.majorPicker.subtractedValue+"px"),this.minorPicker.dragger.css("left","calc(50% - "+this.minorPicker.subtractedValue+"px)"),this.minorPicker.dragger.css("top",Math.round(this.minorPicker.height/360*a.h)-this.minorPicker.subtractedValue+"px");var g=this.getRgbaValue("hsl("+a.h+", 100%, 50%)");this.rgbColor=g}else{this.elm.pickerCurrentColorBackground.css("background","linear-gradient(to bottom, hsl(0, 100%, 100%), hsl("+a.h+", 100%, 50%), hsl(0,0%,0%))");var n=this.majorPicker.height,m=Math.round(n/360*a.h),d=Math.abs(Math.round(n/100*a.s-n));this.majorPicker.dragger.css("left",m-this.majorPicker.subtractedValue+"px"),this.majorPicker.dragger.css("top",d-this.majorPicker.subtractedValue+"px"),this.minorPicker.dragger.css("left","calc(50% - "+this.minorPicker.subtractedValue+"px)");var k=this.minorPicker.height;this.minorPicker.dragger.css("top",Math.abs(Math.round(k/100*a.l-k))-this.minorPicker.subtractedValue+"px"),this.hslColor=a}this.allowOpacity&&(this.elm.pickerCurrentColorOpacityBackground.css("background","linear-gradient(to top, rgba("+t.r+", "+t.g+", "+t.b+", 1), rgba("+t.r+", "+t.g+", "+t.b+", 0))"),this.opacityPicker.dragger.css("left","calc(50% - "+this.opacityPicker.subtractedValue+"px)"),this.opacityPicker.dragger.css("top",Math.round(this.opacityPicker.height/100*(100*t.a))-this.opacityPicker.subtractedValue+"px"))}i&&this.elm.main[0].dispatchEvent(l.changed)}},s.prototype.pickerClicked=function(i,e){this.dragStatus=e,t("body").addClass("cdp-dragging-active");var r;"major"!=e||0!=this.pickerStyle||this.color?"minor"!=e||1!=this.pickerStyle||this.color?"opacity"!=e||this.color||(0==this.pickerStyle?(r=this.minorPicker.dragger.position(),this.setColorWithPosition({x:r.left+this.minorPicker.subtractedValue,y:r.top+this.minorPicker.subtractedValue},"minor")):(r=this.majorPicker.dragger.position(),this.setColorWithPosition({x:r.left+this.majorPicker.subtractedValue,y:r.top+this.majorPicker.subtractedValue},"major"))):(r=this.majorPicker.dragger.position(),this.setColorWithPosition({x:r.left+this.majorPicker.subtractedValue,y:r.top+this.majorPicker.subtractedValue},"major")):(r=this.minorPicker.dragger.position(),this.setColorWithPosition({x:r.left+this.minorPicker.subtractedValue,y:r.top+this.minorPicker.subtractedValue},"minor")),this.pickerMoved(i),this.toggleDraggerListeners(!0)},s.prototype.pickerMoved=function(t){var i;i="major"==this.dragStatus?a(t,this.majorPicker):"minor"==this.dragStatus?a(t,this.minorPicker):a(t,this.opacityPicker),this.setColorWithPosition(i,this.dragStatus,!0),t.preventDefault()},s.prototype.setColorWithPosition=function(t,i,e){e=e||!1;if("major"==i){if(0==this.pickerStyle){for(var r,o,s,a=[this.rgbColor.r,this.rgbColor.g,this.rgbColor.b],c=this.majorPicker.height,l=0;l<a.length;l++){var n=a[l];255==n?s=Math.abs(Math.round(255/c*t.y-255)):(r=Math.round((c-t.y)*(n/c)),o=Math.round((c-t.x)*((255-n)/c)),s=r+Math.abs(Math.round((c-t.y)*(o/c)))),a[l]=s}this.setColor({r:a[0],g:a[1],b:a[2],a:this.rgbaColor.a},e,!0,!1),this.allowOpacity&&this.elm.pickerCurrentColorOpacityBackground.css("background","linear-gradient(to top, rgba("+a[0]+", "+a[1]+", "+a[2]+", 1), rgba("+a[0]+", "+a[1]+", "+a[2]+", 0))")}else if(1==this.pickerStyle){var c=this.majorPicker.height,h=Math.round(t.x*(360/c)),d=Math.abs(Math.round(t.y*(100/c))-100);this.elm.pickerCurrentColorBackground.css("background","linear-gradient(to bottom, hsl(0, 100%, 100%), hsl("+h+", "+d+"%, 50%), hsl(0, 0%, 0%))"),this.hslColor.h=h,this.hslColor.s=d;var p=(m=this.minorPicker.dragger.position()).left+this.minorPicker.subtractedValue,u=m.top+this.minorPicker.subtractedValue;this.setColorWithPosition({x:p,y:u},"minor",e)}}else if("minor"==i){if(0==this.pickerStyle){var c=this.minorPicker.height,h=Math.round(t.y*(360/c));this.elm.pickerCurrentColorBackground.css("background","hsl("+h+", 100%, 50%)");a=this.getRgbaValue("hsl("+h+", 100%, 50%)");this.rgbColor=a;var m=this.majorPicker.dragger.position(),g=m.left+this.majorPicker.subtractedValue,k=m.top+this.majorPicker.subtractedValue;this.setColorWithPosition({x:g,y:k},"major",e)}else if(1==this.pickerStyle){var c=this.minorPicker.height,b=Math.abs(Math.round(t.y*(100/c))-100);this.hslColor.l=b;var C=this.getRgbaValue("hsl("+this.hslColor.h+", "+this.hslColor.s+"%, "+this.hslColor.l+"%)");this.setColor({r:C.r,g:C.g,b:C.b,a:this.rgbaColor.a},e,!0,!1),this.allowOpacity&&this.elm.pickerCurrentColorOpacityBackground.css("background","linear-gradient(to top, rgba("+C.r+", "+C.g+", "+C.b+", 1), rgba("+C.r+", "+C.g+", "+C.b+", 0))")}}else if("opacity"==i){var c=this.opacityPicker.height,v=Math.round(100/c*t.y)/100;this.setColor({r:this.rgbaColor.r,g:this.rgbaColor.g,b:this.rgbaColor.b,a:v},e,!0,!1)}},s.prototype.pickerReleased=function(){t("body").removeClass("cdp-dragging-active"),this.toggleDraggerListeners(!1)},s.prototype.toggleDraggerListeners=function(i){i?(t(document).bind("mousemove",this.pickerMovedBind),t(document).bind("touchmove",this.pickerMovedBind),t(document).bind("mouseup",this.pickerReleasedBind),t(document).bind("touchend",this.pickerReleasedBind)):(t(document).unbind("mousemove",this.pickerMovedBind),t(document).unbind("touchmove",this.pickerMovedBind),t(document).unbind("mouseup",this.pickerReleasedBind),t(document).unbind("touchend",this.pickerReleasedBind))},s.prototype.setColorWithValue=function(t,i){if((t=this.elm.colorValueInput.val()).trim()&&t!=this.color){var e=this.getRgbaValue(t);this.setColor(e,!0,!1,!0)}},s.prototype.setColorWithInitialColor=function(){if(this.initialColor!=this.color)if(this.initialColor){var t=this.getRgbaValue(this.initialColor);this.setColor(t,!0,!0,!0)}else this.clearColor()},s.prototype.clearColor=function(t){t=t||!1,(this.color||t)&&(this.majorPicker.dragger.css("left",-1*this.majorPicker.subtractedValue+"px"),this.majorPicker.dragger.css("top",-1*this.majorPicker.subtractedValue+"px"),this.minorPicker.dragger.css("left","calc(50% - "+this.minorPicker.subtractedValue+"px)"),this.minorPicker.dragger.css("top",-1*this.minorPicker.subtractedValue+"px"),this.rgbaColor.a=1,0==this.pickerStyle?(this.elm.pickerCurrentColorBackground.css("background","hsl(0,100%,50%)"),this.majorPicker.dragger.addClass("cdp-dark")):1==this.pickerStyle&&(this.elm.pickerCurrentColorBackground.css("background","linear-gradient(to bottom, hsl(0,100%,100%), hsl(0,100%,50%), hsl(0,0%,0%))"),this.minorPicker.dragger.addClass("cdp-dark")),this.allowOpacity&&(this.elm.pickerCurrentColorOpacityBackground.css("background","linear-gradient(to top, rgba(255,255,255,1), rgba(255,255,255,0))"),this.opacityPicker.dragger.css("left","calc(50% - "+this.opacityPicker.subtractedValue+"px)"),this.opacityPicker.dragger.css("top",this.opacityPicker.height-this.opacityPicker.subtractedValue+"px"),this.opacityPicker.dragger.addClass("cdp-dark")),this.showColorValue&&(this.elm.colorValueInput.val(""),this.elm.colorValueInput.addClass("cdp-dark")),this.elm.currentColorConsole.css("background","transparent"),this.elm.clearColor.addClass("cdp-dark"),this.embed||this.elm.overlay.css("background","transparent"),t||(this.color=null,this.elm.main[0].dispatchEvent(l.changed)))},s.prototype.addColorElementToPalette=function(i){var e="rgba("+i.r+", "+i.g+", "+i.b+", "+i.a+")",r=t(document.createElement("div"));r.addClass("cdp-palette-element"),r.addClass("cdp-background-type-opacity"),r.html('<div style="background:'+e+';"></div>'),r.bind("click",function(){this.setColorFromPalette(i)}.bind(this)),this.elm.palette.append(r)},s.prototype.addColorToPalette=function(){var t="rgba("+this.rgbaColor.r+", "+this.rgbaColor.g+", "+this.rgbaColor.b+", "+this.rgbaColor.a+")";this.color&&-1==this.paletteColors.indexOf(t)&&(this.paletteColors.push(t),this.addColorElementToPalette(this.rgbaColor))},s.prototype.setColorFromPalette=function(t){this.setColor(t,!0,!0,!0)},s.prototype.setInitialColorIcon=function(){if(this.initialColor){this.elm.initialColor.css("background",this.initialColor);var t=this.getRgbaValue(this.initialColor);c(t)||t.a<.4?this.elm.initialColor.addClass("cdp-dark"):this.elm.initialColor.removeClass("cdp-dark")}else this.elm.initialColor.css("background","transparent"),this.elm.initialColor.addClass("cdp-dark")},s.prototype.openPicker=function(){"none"!=this.elm.picker.css("display")||this.animationProcessing||(this.animationProcessing=!0,this.embed||(this.elm.picker.addClass("cdp-visibility-hidden"),this.setPosition(),this.elm.picker.removeClass("cdp-visibility-hidden")),t(this.elm.picker[0]).fadeIn(100,function(){this.animationProcessing=!1}.bind(this)),0==this.embed&&(t(window).bind("resize",this.setPositionBind),0==this.showButtons&&(t(document).bind("mousedown",this.closePickerBind),t(document).bind("touchstart",this.closePickerBind))),this.elm.main[0].dispatchEvent(l.open))},s.prototype.closePicker=function(i,e){(i&&!this.elm.picker[0].contains(i.target)||e)&&!this.animationProcessing&&(this.animationProcessing=!0,this.elm.picker.fadeOut(100,function(){this.animationProcessing=!1}.bind(this)),0==this.embed&&(t(window).unbind("resize",this.setPositionBind),0==this.showButtons&&(t(document).unbind("mousedown",this.closePickerBind),t(document).unbind("touchstart",this.closePickerBind))),this.elm.main[0].dispatchEvent(l.close))},s.prototype.setPosition=function(){var i=this.elm.main.offset(),e=i.left,r=i.top,o=e+this.elm.picker.width()+20,s=e-this.elm.picker.width(),a=r+this.elm.picker.height()+50,c=r-(this.elm.picker.height()+10),l=t(window).width()+window.pageXOffset,n=t(window).height()+window.pageYOffset;o>=l&&s>0?this.elm.picker.addClass("cdp-right"):this.elm.picker.removeClass("cdp-right"),a>=n&&c>0?this.elm.picker.addClass("cdp-bottom"):this.elm.picker.removeClass("cdp-bottom")},s.prototype.get=function(){return this.color?this.convertColor(this.rgbaColor):{value:null}},s.prototype.set=function(t){if(!t&&this.allowClearColor)this.clearColor();else if(t){var i=this.getRgbaValue(t);this.setColor(i,!0,!0,!0)}else t=this.color},s.prototype.show=function(){this.openPicker()},s.prototype.hide=function(){"none"!=this.elm.picker.css("display")&&this.closePicker(null,!0)},s.prototype.save=function(){this.initialColor=this.color,this.showColorValue&&this.setInitialColorIcon(),this.embed||this.hide(),this.elm.main[0].dispatchEvent(l.save)},s.prototype.cancel=function(){this.setColorWithInitialColor(),this.embed||this.hide(),this.elm.main[0].dispatchEvent(l.cancel)},s.prototype.getRgbaValue=function(t){this.elm.rgbaColor.css("background",t);var i=this.elm.rgbaColor.css("background-color").replace(/^(rgb|rgba)\(/,"").replace(/\)$/,"").replace(/\s/g,"").split(",");return{r:parseInt(i[0]),g:parseInt(i[1]),b:parseInt(i[2]),a:i[3]?parseFloat(i[3]):1}},s.prototype.convertColor=function(t){var i=t.r,e=t.g,r=t.b,o=t.a;if(1!=o&&this.allowOpacity)return"hsl"!=this.colorFormat&&"hsla"!=this.colorFormat?{value:"rgba("+i+","+e+","+r+","+o+")",r:i,g:e,b:r,a:o}:{value:"hsla("+(s=p.rgbTohsl({r:i,g:e,b:r})).h+","+s.s+"%,"+s.l+"%,"+o+")",h:s.h,s:s.s,l:s.l,a:o};if("hex"==this.colorFormat)return{value:p.rgbTohex({r:i,g:e,b:r})};if("rgb"==this.colorFormat)return{value:"rgb("+i+","+e+","+r+")",r:i,g:e,b:r};if("rgba"==this.colorFormat)return{value:"rgba("+i+","+e+","+r+",1)",r:i,g:e,b:r,a:1};var s=p.rgbTohsl({r:i,g:e,b:r});return"hsl"==this.colorFormat?{value:"hsl("+s.h+","+s.s+"%,"+s.l+"%)",h:s.h,s:s.s,l:s.l}:{value:"hsla("+s.h+","+s.s+"%,"+s.l+"%,1)",h:s.h,s:s.s,l:s.l,a:1}};var p={rgbTohex:function(t){return("#"+("0"+parseInt(t.r,10).toString(16)).slice(-2)+("0"+parseInt(t.g,10).toString(16)).slice(-2)+("0"+parseInt(t.b,10).toString(16)).slice(-2)).toUpperCase()},rgbTohsl:function(t){var i=t.r/255,e=t.g/255,r=t.b/255,o=Math.max(i,e,r),s=Math.min(i,e,r),a=(o+s)/2,c=0,l=0;return o!=s&&(c=a<.5?(o-s)/(o+s):(o-s)/(2-o-s),l=i==o?(e-r)/(o-s):e==o?2+(r-i)/(o-s):4+(i-e)/(o-s)),a=Math.round(100*a),c=Math.round(100*c),(l=Math.round(60*l))<0&&(l+=360),{h:l,s:c,l:a}}}});