/**
 *   Cordelia color picker
 *   version: 1.0.0
 *    author: Cevad Tokatli <cevadtokatli@hotmail.com>
 *   website: http://cevadtokatli.com
 *    github: https://github.com/cevadtokatli/cordelia-jquery
 *   license: MIT
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(g){"use strict";var m={open:i("open"),close:i("close"),save:i("save"),cancel:i("cancel"),changed:i("changed")},l={size:"medium",embed:!0,pickerStyle:0,allowOpacity:!0,allowClearColor:!1,showColorValue:!0,colorFormat:"hex",color:"#FF0000",showButtons:!0,showPalette:!0,paletteColors:["#FFFFB5","#FBBD87","#F45151","#7AEA89","#91C8E7","#8EB4E6","#B0A7F1"],allowPaletteAddColor:!0},s=[];g.fn.cordelia=function(e,r){var o;return this.each(function(t){if("string"!=typeof e)new n(this,e);else{var i=s.filter(function(t){return t.elm.main[0]==this?t:null}.bind(this));if(0==i.length)throw new Error("Element could not be found");if(i=i[0],"get"==e)o=i.get();else if("set"==e)i.set(r);else if("show"==e)i.show();else if("hide"==e)i.hide();else if("save"==e)i.save();else{if("cancel"!=e)throw new Error("Method could not be found");i.cancel()}}}),o},addEventListener("load",function(){for(var t=document.querySelectorAll("cordelia"),i=0;i<t.length;i++)a(t[i]);var e=document.querySelectorAll("*[cordelia]");for(i=0;i<e.length;i++)c(e[i])});var t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;t&&new t(function(t){t.forEach(function(t){if("attributes"==t.type){var i=t.target;i.getAttribute("cordelia")&&c(i)}else for(var e=0;e<t.addedNodes.length;e++)r=e,o=void 0,-1==(o=t.addedNodes[r]).nodeName.indexOf("#")&&("CORDELIA"==o.nodeName?a(o):o.getAttribute("cordelia")&&c(o));var r,o})}).observe(document,{attributes:!0,childList:!0,subtree:!0,characterData:!0});function a(t){var i=r(t),e=document.createElement("div");g(t).attr("id")&&g(e).attr("id",g(t).attr("id")),g(t).replaceWith(e),new n(e,i)}function c(t){g(t).removeAttr("cordelia"),new n(t,r(t))}function r(t){for(var i=t.attributes,e={},r=0;r<i.length;r++){var o=i[r];if(-1<o.name.indexOf("cordelia-")){for(var s=o.name.replace("cordelia-","");-1<s.indexOf("-");){var a=s.indexOf("-");s[a+1]&&(s=s.substring(0,a)+s[a+1].toUpperCase()+s.substring(a+2,s.length))}if(void 0!==l[s]){var c=o.value;"true"==c?c=!0:"false"==c&&(c=!1),"paletteColors"==s&&(c=c.split(",")),e[s]=c}g(t).removeAttr(o.name),r-=1}}return e}function i(t){var i=document.createEvent("HTMLEvents")||document.createEvent("event");return i.initEvent(t,!1,!0),i}function n(t,i){this.elm={},this.elm.main=g(t),this.extractAttributes(i),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&!this.embed?this.size="small":"small"!=this.size&&"large"!=this.size&&(this.size="medium"),this.majorPicker={},this.minorPicker={},this.opacityPicker={},"small"==this.size?(this.majorPicker.width=125,this.majorPicker.height=125,this.minorPicker.width=20,this.minorPicker.height=125):"medium"==this.size?(this.majorPicker.width=175,this.majorPicker.height=175,this.minorPicker.width=30,this.minorPicker.height=175):(this.majorPicker.width=250,this.majorPicker.height=250,this.minorPicker.width=30,this.minorPicker.height=250),this.majorPicker.subtractedValue=9,this.minorPicker.subtractedValue=7,this.allowOpacity&&(this.opacityPicker.width=this.minorPicker.width,this.opacityPicker.height=this.minorPicker.height,this.opacityPicker.subtractedValue=this.minorPicker.subtractedValue),0!=this.pickerStyle&&(this.pickerStyle=1),"rgb"!=this.colorFormat&&"rgba"!=this.colorFormat&&"hsl"!=this.colorFormat&&"hsla"!=this.colorFormat&&(this.colorFormat="hex"),this.color||(this.allowClearColor?this.color=null:"hex"==this.colorFormat?this.color="#FF000":"rgb"==this.colorFormat?this.color="rgb(255,0,0)":"rgba"==this.colorFormat?this.color="rgba(255,0,0,1)":"hsl"==this.colorFormat?this.color="hsl(0,100%,50%)":"hsla"==this.colorFormat&&(this.color="hsla(0,100%,50%,1)")),this.init(),s.push(this)}function e(t,i){var e=i.container.offset(),r=t.clientX?t.clientX+window.pageXOffset:t.pageX,o=t.clientY?t.clientY+window.pageYOffset:t.pageY,s=r-(e.left+i.subtractedValue),a=o-(e.top+i.subtractedValue);return s<-i.subtractedValue?s=-i.subtractedValue:s>i.width-i.subtractedValue&&(s=i.width-i.subtractedValue),a<-i.subtractedValue?a=-i.subtractedValue:a>i.height-i.subtractedValue&&(a=i.height-i.subtractedValue),i.dragger.css("left",s+"px"),i.dragger.css("top",a+"px"),{x:s+i.subtractedValue,y:a+i.subtractedValue}}function k(t){return 125<Math.round((299*t.r+587*t.g+114*t.b)/1e3)}n.prototype.extractAttributes=function(t){for(var i in l)void 0!==t[i]?this[i]=t[i]:this[i]=l[i]},n.prototype.init=function(){if(this.pickerMovedBind=this.pickerMoved.bind(this),this.pickerReleasedBind=this.pickerReleased.bind(this),this.closePickerBind=this.closePicker.bind(this),this.setPositionBind=this.setPosition.bind(this),this.embed?this.elm.picker=this.elm.main:(this.elm.main.addClass("cdp-wrapper"),this.elm.main.addClass("cdp-background-type-opacity"),this.elm.main.bind("click",this.openPicker.bind(this)),this.elm.overlay=g(document.createElement("div")),this.elm.overlay.addClass("cdp-wrapper-overlay"),this.elm.main.append(this.elm.overlay),this.elm.picker=g(document.createElement("div")),this.elm.picker.css("display","none"),this.elm.overlay.append(this.elm.picker)),this.elm.picker.addClass("cdp-container"),this.elm.picker.attr("cdp-size",this.size),this.elm.rgbaColor=g(document.createElement("div")),this.elm.rgbaColor.addClass("cdp-hidden"),this.elm.picker.append(this.elm.rgbaColor),this.rgbaColor={},this.rgbaColor.a=1,this.rgbColor={},this.hslColor={},this.color){var t=this.getRgbaValue(this.color),i=this.convertColor(t).value;this.color=i,this.rgbaColor=t}this.initialColor=i;var e,r,o,s=g(document.createElement("div"));if(s.addClass("cdp-picker-container"),this.elm.picker.append(s),this.majorPicker.container=g(document.createElement("div")),this.majorPicker.container.addClass("cdp-major-picker"),s.append(this.majorPicker.container),this.minorPicker.container=g(document.createElement("div")),this.minorPicker.container.addClass("cdp-minor-picker"),s.append(this.minorPicker.container),0==this.pickerStyle?(this.majorPicker.container.html('<div class="cdp-major-picker-gradient cdp-background-type-current-color"><div class="cdp-major-picker-gradient cdp-gradient-type-lr-white"><div class="cdp-major-picker-gradient cdp-gradient-type-bt-black cdp-last-gradient-child"></div></div></div>'),this.elm.pickerCurrentColorBackground=this.majorPicker.container.find(".cdp-background-type-current-color"),this.minorPicker.container.html('<div class="cdp-minor-picker-gradient cdp-gradient-type-tb-colorful cdp-last-gradient-child"></div>')):1==this.pickerStyle&&(this.majorPicker.container.html('<div class="cdp-major-picker-gradient cdp-gradient-type-lr-colorful"><div class="cdp-major-picker-gradient cdp-gradient-type-bt-gray cdp-last-gradient-child"></div></div>'),this.minorPicker.container.html('<div class="cdp-minor-picker-gradient cdp-gradient-type-bt-white-current-color-black cdp-last-gradient-child"></div>'),this.elm.pickerCurrentColorBackground=this.minorPicker.container.find(".cdp-gradient-type-bt-white-current-color-black")),this.majorPicker.dragger=g(document.createElement("div")),this.majorPicker.dragger.addClass("cdp-major-dragger"),this.majorPicker.container.find(".cdp-last-gradient-child").append(this.majorPicker.dragger),this.majorPicker.container.bind("mousedown",function(t){this.pickerClicked(t,"major")}.bind(this)),this.majorPicker.container.bind("touchstart",function(t){this.pickerClicked(t,"major")}.bind(this)),this.minorPicker.dragger=g(document.createElement("div")),this.minorPicker.dragger.addClass("cdp-minor-dragger"),this.minorPicker.container.find(".cdp-last-gradient-child").append(this.minorPicker.dragger),this.minorPicker.container.bind("mousedown",function(t){this.pickerClicked(t,"minor")}.bind(this)),this.minorPicker.container.bind("touchstart",function(t){this.pickerClicked(t,"minor")}.bind(this)),this.allowOpacity&&(this.opacityPicker.container=g(document.createElement("div")),this.opacityPicker.container.addClass("cdp-opacity-picker"),this.opacityPicker.container.html('<div class="cdp-opacity-picker-gradient cdp-background-type-opacity"><div class="cdp-opacity-picker-gradient cdp-gradient-type-bt-current-color cdp-last-gradient-child"><div class="cdp-opacity-dragger"></div></div></div>'),s.append(this.opacityPicker.container),this.elm.pickerCurrentColorOpacityBackground=this.opacityPicker.container.find(".cdp-gradient-type-bt-current-color"),this.opacityPicker.dragger=this.opacityPicker.container.find(".cdp-opacity-dragger"),this.opacityPicker.container.bind("mousedown",function(t){this.pickerClicked(t,"opacity")}.bind(this)),this.opacityPicker.container.bind("touchstart",function(t){this.pickerClicked(t,"opacity")}.bind(this))),this.allowClearColor||this.showColorValue||this.showButtons){var a=g(document.createElement("div"));if(a.addClass("cdp-console-container"),this.elm.picker.append(a),this.allowClearColor||this.showColorValue){var c=g(document.createElement("div"));c.addClass("cdp-color-console-container"),c.addClass("cdp-background-type-opacity"),a.append(c),this.elm.currentColorConsole=g(document.createElement("div")),this.elm.currentColorConsole.addClass("cdp-current-color-console"),c.append(this.elm.currentColorConsole),this.showColorValue?(this.elm.initialColor=g(document.createElement("div")),this.elm.initialColor.addClass("cdp-initial-color"),this.elm.initialColor.html('<i class="cdp-icons"></i>'),this.elm.initialColor.bind("click",this.setColorWithInitialColor.bind(this)),this.elm.currentColorConsole.before(this.elm.initialColor),this.elm.colorValueInput=g(document.createElement("input")),this.elm.colorValueInput.addClass("cdp-current-color"),this.elm.colorValueInput.attr("type","text"),this.elm.colorValueInput.attr("spellcheck",!1),this.elm.colorValueInput.bind("change",function(){this.setColorWithValue()}.bind(this)),this.elm.currentColorConsole.append(this.elm.colorValueInput),this.elm.colorValueInput.value=this.color,this.setInitialColorIcon()):a.addClass("cdp-current-color-non-showing"),this.allowClearColor?(this.elm.clearColor=g(document.createElement("div")),this.elm.clearColor.addClass("cdp-clear-color"),this.elm.clearColor.html('<i class="cdp-icons"></i>'),this.elm.clearColor.bind("click",function(){this.clearColor()}.bind(this)),this.elm.currentColorConsole.append(this.elm.clearColor)):a.addClass("cdp-clear-color-non-showing")}else a.addClass("cdp-color-console-non-showing");if(this.showButtons){var l=g(document.createElement("div"));l.addClass("cdp-button-container"),l.html('<div class="cdp-button" cdp-function="save"><i class="cdp-icons"></i>SAVE</div><div class="cdp-button" cdp-function="cancel"><i class="cdp-icons"></i>CANCEL</div>'),a.append(l);var n=l.find('div[cdp-function="save"]'),h=l.find('div[cdp-function="cancel"]');n.bind("click",this.save.bind(this)),h.bind("click",this.cancel.bind(this))}}if(this.showPalette){var d=g(document.createElement("div"));d.addClass("cdp-arrow-div"),this.elm.picker.append(d);var p=g(document.createElement("i"));if(p.addClass("cdp-icons"),p.bind("click",function(){this.elm.paletteContainer.fadeToggle(100)}.bind(this)),d.append(p),this.elm.paletteContainer=g(document.createElement("div")),this.elm.paletteContainer.css("display","none"),this.elm.paletteContainer.html('<hr class="cdp-palette-line" /><div class="cdp-palette"></div>'),this.elm.picker.append(this.elm.paletteContainer),this.elm.palette=this.elm.picker.find(".cdp-palette"),this.allowPaletteAddColor){var u=g(document.createElement("div"));u.addClass("cdp-palette-add-element"),u.html('<i class="cdp-icons"></i>'),u.bind("click",this.addColorToPalette.bind(this)),this.elm.palette.append(u)}for(var m=0;m<this.paletteColors.length;m++)e=m,void 0,o=(r=this).getRgbaValue(r.paletteColors[e]),r.paletteColors[e]="rgba("+o.r+", "+o.g+", "+o.b+", "+o.a+")",r.addColorElementToPalette(o)}this.color?this.setColor(null,!1,!0,!0):this.clearColor(!0)},n.prototype.setColor=function(t,i,e,r){var o,s;if(t&&(o=this.convertColor(t),this.rgbaColor=t),o&&o.value!=this.color||!t){if(t?this.color=o.value:t=this.rgbaColor,s=k(t),this.embed||this.elm.overlay.css("background",this.color),this.elm.currentColorConsole&&this.elm.currentColorConsole.css("background",this.color),s?0==this.pickerStyle?this.majorPicker.dragger.addClass("cdp-dark"):1==this.pickerStyle&&this.minorPicker.dragger.addClass("cdp-dark"):0==this.pickerStyle?this.majorPicker.dragger.removeClass("cdp-dark"):1==this.pickerStyle&&this.minorPicker.dragger.removeClass("cdp-dark"),this.allowOpacity&&(s||t.a<.25?this.opacityPicker.dragger.addClass("cdp-dark"):this.opacityPicker.dragger.removeClass("cdp-dark")),this.showColorValue&&(e&&this.elm.colorValueInput.val(this.color),s||t.a<.4?this.elm.colorValueInput.addClass("cdp-dark"):this.elm.colorValueInput.removeClass("cdp-dark")),this.elm.clearColor&&(s||t.a<.4?this.elm.clearColor.addClass("cdp-dark"):this.elm.clearColor.removeClass("cdp-dark")),r){var a=b.rgbTohsl(t);if(0==this.pickerStyle){this.elm.pickerCurrentColorBackground.css("background","hsl("+a.h+", 100%, 50%");var c=this.majorPicker.height,l=Math.max(t.r,t.g,t.b),n=Math.abs(Math.round(c/255*l-c)),h=Math.min(t.r,t.g,t.b),d=Math.abs(Math.round(c/255*h-c))-Math.abs(Math.round(n/l*h));this.majorPicker.dragger.css("left",d-this.majorPicker.subtractedValue+"px"),this.majorPicker.dragger.css("top",n-this.majorPicker.subtractedValue+"px"),this.minorPicker.dragger.css("left","calc(50% - "+this.minorPicker.subtractedValue+"px)"),this.minorPicker.dragger.css("top",Math.round(this.minorPicker.height/360*a.h)-this.minorPicker.subtractedValue+"px");var p=this.getRgbaValue("hsl("+a.h+", 100%, 50%)");this.rgbColor=p}else{this.elm.pickerCurrentColorBackground.css("background","linear-gradient(to bottom, hsl(0, 100%, 100%), hsl("+a.h+", 100%, 50%), hsl(0,0%,0%))");c=this.majorPicker.height,d=Math.round(c/360*a.h),n=Math.abs(Math.round(c/100*a.s-c));this.majorPicker.dragger.css("left",d-this.majorPicker.subtractedValue+"px"),this.majorPicker.dragger.css("top",n-this.majorPicker.subtractedValue+"px"),this.minorPicker.dragger.css("left","calc(50% - "+this.minorPicker.subtractedValue+"px)");var u=this.minorPicker.height;this.minorPicker.dragger.css("top",Math.abs(Math.round(u/100*a.l-u))-this.minorPicker.subtractedValue+"px"),this.hslColor=a}this.allowOpacity&&(this.elm.pickerCurrentColorOpacityBackground.css("background","linear-gradient(to top, rgba("+t.r+", "+t.g+", "+t.b+", 1), rgba("+t.r+", "+t.g+", "+t.b+", 0))"),this.opacityPicker.dragger.css("left","calc(50% - "+this.opacityPicker.subtractedValue+"px)"),this.opacityPicker.dragger.css("top",Math.round(this.opacityPicker.height/100*(100*t.a))-this.opacityPicker.subtractedValue+"px"))}i&&this.elm.main[0].dispatchEvent(m.changed)}},n.prototype.pickerClicked=function(t,i){var e;this.dragStatus=i,g("body").addClass("cdp-dragging-active"),"major"!=i||0!=this.pickerStyle||this.color?"minor"!=i||1!=this.pickerStyle||this.color?"opacity"!=i||this.color||(0==this.pickerStyle?(e=this.minorPicker.dragger.position(),this.setColorWithPosition({x:e.left+this.minorPicker.subtractedValue,y:e.top+this.minorPicker.subtractedValue},"minor")):(e=this.majorPicker.dragger.position(),this.setColorWithPosition({x:e.left+this.majorPicker.subtractedValue,y:e.top+this.majorPicker.subtractedValue},"major"))):(e=this.majorPicker.dragger.position(),this.setColorWithPosition({x:e.left+this.majorPicker.subtractedValue,y:e.top+this.majorPicker.subtractedValue},"major")):(e=this.minorPicker.dragger.position(),this.setColorWithPosition({x:e.left+this.minorPicker.subtractedValue,y:e.top+this.minorPicker.subtractedValue},"minor")),this.pickerMoved(t),this.toggleDraggerListeners(!0)},n.prototype.pickerMoved=function(t){var i;i="major"==this.dragStatus?e(t,this.majorPicker):"minor"==this.dragStatus?e(t,this.minorPicker):e(t,this.opacityPicker),this.setColorWithPosition(i,this.dragStatus,!0),t.preventDefault()},n.prototype.setColorWithPosition=function(t,i,e){if(e=e||!1,"major"==i){if(0==this.pickerStyle){for(var r,o,s,a=[this.rgbColor.r,this.rgbColor.g,this.rgbColor.b],c=this.majorPicker.height,l=0;l<a.length;l++){var n=a[l];255==n?s=Math.abs(Math.round(255/c*t.y-255)):(r=Math.round((c-t.y)*(n/c)),o=Math.round((c-t.x)*((255-n)/c)),s=r+Math.abs(Math.round((c-t.y)*(o/c)))),a[l]=s}this.setColor({r:a[0],g:a[1],b:a[2],a:this.rgbaColor.a},e,!0,!1),this.allowOpacity&&this.elm.pickerCurrentColorOpacityBackground.css("background","linear-gradient(to top, rgba("+a[0]+", "+a[1]+", "+a[2]+", 1), rgba("+a[0]+", "+a[1]+", "+a[2]+", 0))")}else if(1==this.pickerStyle){c=this.majorPicker.height;var h=Math.round(t.x*(360/c)),d=Math.abs(Math.round(t.y*(100/c))-100);this.elm.pickerCurrentColorBackground.css("background","linear-gradient(to bottom, hsl(0, 100%, 100%), hsl("+h+", "+d+"%, 50%), hsl(0, 0%, 0%))"),this.hslColor.h=h,this.hslColor.s=d;var p=(m=this.minorPicker.dragger.position()).left+this.minorPicker.subtractedValue,u=m.top+this.minorPicker.subtractedValue;this.setColorWithPosition({x:p,y:u},"minor",e)}}else if("minor"==i){if(0==this.pickerStyle){c=this.minorPicker.height,h=Math.round(t.y*(360/c));this.elm.pickerCurrentColorBackground.css("background","hsl("+h+", 100%, 50%)");a=this.getRgbaValue("hsl("+h+", 100%, 50%)");this.rgbColor=a;var m,g=(m=this.majorPicker.dragger.position()).left+this.majorPicker.subtractedValue,k=m.top+this.majorPicker.subtractedValue;this.setColorWithPosition({x:g,y:k},"major",e)}else if(1==this.pickerStyle){c=this.minorPicker.height;var b=Math.abs(Math.round(t.y*(100/c))-100);this.hslColor.l=b;var C=this.getRgbaValue("hsl("+this.hslColor.h+", "+this.hslColor.s+"%, "+this.hslColor.l+"%)");this.setColor({r:C.r,g:C.g,b:C.b,a:this.rgbaColor.a},e,!0,!1),this.allowOpacity&&this.elm.pickerCurrentColorOpacityBackground.css("background","linear-gradient(to top, rgba("+C.r+", "+C.g+", "+C.b+", 1), rgba("+C.r+", "+C.g+", "+C.b+", 0))")}}else if("opacity"==i){c=this.opacityPicker.height;var v=Math.round(100/c*t.y)/100;this.setColor({r:this.rgbaColor.r,g:this.rgbaColor.g,b:this.rgbaColor.b,a:v},e,!0,!1)}},n.prototype.pickerReleased=function(){g("body").removeClass("cdp-dragging-active"),this.toggleDraggerListeners(!1)},n.prototype.toggleDraggerListeners=function(t){t?(g(document).bind("mousemove",this.pickerMovedBind),g(document).bind("touchmove",this.pickerMovedBind),g(document).bind("mouseup",this.pickerReleasedBind),g(document).bind("touchend",this.pickerReleasedBind)):(g(document).unbind("mousemove",this.pickerMovedBind),g(document).unbind("touchmove",this.pickerMovedBind),g(document).unbind("mouseup",this.pickerReleasedBind),g(document).unbind("touchend",this.pickerReleasedBind))},n.prototype.setColorWithValue=function(t,i){if((t=this.elm.colorValueInput.val()).trim()&&t!=this.color){var e=this.getRgbaValue(t);this.setColor(e,!0,!1,!0)}},n.prototype.setColorWithInitialColor=function(){if(this.initialColor!=this.color)if(this.initialColor){var t=this.getRgbaValue(this.initialColor);this.setColor(t,!0,!0,!0)}else this.clearColor()},n.prototype.clearColor=function(t){t=t||!1,(this.color||t)&&(this.majorPicker.dragger.css("left",-1*this.majorPicker.subtractedValue+"px"),this.majorPicker.dragger.css("top",-1*this.majorPicker.subtractedValue+"px"),this.minorPicker.dragger.css("left","calc(50% - "+this.minorPicker.subtractedValue+"px)"),this.minorPicker.dragger.css("top",-1*this.minorPicker.subtractedValue+"px"),this.rgbaColor.a=1,0==this.pickerStyle?(this.elm.pickerCurrentColorBackground.css("background","hsl(0,100%,50%)"),this.majorPicker.dragger.addClass("cdp-dark")):1==this.pickerStyle&&(this.elm.pickerCurrentColorBackground.css("background","linear-gradient(to bottom, hsl(0,100%,100%), hsl(0,100%,50%), hsl(0,0%,0%))"),this.minorPicker.dragger.addClass("cdp-dark")),this.allowOpacity&&(this.elm.pickerCurrentColorOpacityBackground.css("background","linear-gradient(to top, rgba(255,255,255,1), rgba(255,255,255,0))"),this.opacityPicker.dragger.css("left","calc(50% - "+this.opacityPicker.subtractedValue+"px)"),this.opacityPicker.dragger.css("top",this.opacityPicker.height-this.opacityPicker.subtractedValue+"px"),this.opacityPicker.dragger.addClass("cdp-dark")),this.showColorValue&&(this.elm.colorValueInput.val(""),this.elm.colorValueInput.addClass("cdp-dark")),this.elm.currentColorConsole.css("background","transparent"),this.elm.clearColor.addClass("cdp-dark"),this.embed||this.elm.overlay.css("background","transparent"),t||(this.color=null,this.elm.main[0].dispatchEvent(m.changed)))},n.prototype.addColorElementToPalette=function(t){var i="rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")",e=g(document.createElement("div"));e.addClass("cdp-palette-element"),e.addClass("cdp-background-type-opacity"),e.html('<div style="background:'+i+';"></div>'),e.bind("click",function(){this.setColorFromPalette(t)}.bind(this)),this.elm.palette.append(e)},n.prototype.addColorToPalette=function(){var t="rgba("+this.rgbaColor.r+", "+this.rgbaColor.g+", "+this.rgbaColor.b+", "+this.rgbaColor.a+")";this.color&&-1==this.paletteColors.indexOf(t)&&(this.paletteColors.push(t),this.addColorElementToPalette(this.rgbaColor))},n.prototype.setColorFromPalette=function(t){this.setColor(t,!0,!0,!0)},n.prototype.setInitialColorIcon=function(){if(this.initialColor){this.elm.initialColor.css("background",this.initialColor);var t=this.getRgbaValue(this.initialColor);k(t)||t.a<.4?this.elm.initialColor.addClass("cdp-dark"):this.elm.initialColor.removeClass("cdp-dark")}else this.elm.initialColor.css("background","transparent"),this.elm.initialColor.addClass("cdp-dark")},n.prototype.openPicker=function(){"none"!=this.elm.picker.css("display")||this.animationProcessing||(this.animationProcessing=!0,this.embed||(this.elm.picker.addClass("cdp-visibility-hidden"),this.setPosition(),this.elm.picker.removeClass("cdp-visibility-hidden")),g(this.elm.picker[0]).fadeIn(100,function(){this.animationProcessing=!1}.bind(this)),0==this.embed&&(g(window).bind("resize",this.setPositionBind),0==this.showButtons&&(g(document).bind("mousedown",this.closePickerBind),g(document).bind("touchstart",this.closePickerBind))),this.elm.main[0].dispatchEvent(m.open))},n.prototype.closePicker=function(t,i){(t&&!this.elm.picker[0].contains(t.target)||i)&&!this.animationProcessing&&(this.animationProcessing=!0,this.elm.picker.fadeOut(100,function(){this.animationProcessing=!1}.bind(this)),0==this.embed&&(g(window).unbind("resize",this.setPositionBind),0==this.showButtons&&(g(document).unbind("mousedown",this.closePickerBind),g(document).unbind("touchstart",this.closePickerBind))),this.elm.main[0].dispatchEvent(m.close))},n.prototype.setPosition=function(){var t=this.elm.main.offset(),i=t.left,e=t.top,r=i+this.elm.picker.width()+20,o=i-this.elm.picker.width(),s=e+this.elm.picker.height()+50,a=e-(this.elm.picker.height()+10),c=g(window).width()+window.pageXOffset,l=g(window).height()+window.pageYOffset;c<=r&&0<o?this.elm.picker.addClass("cdp-right"):this.elm.picker.removeClass("cdp-right"),l<=s&&0<a?this.elm.picker.addClass("cdp-bottom"):this.elm.picker.removeClass("cdp-bottom")},n.prototype.get=function(){return this.color?this.convertColor(this.rgbaColor):{value:null}},n.prototype.set=function(t){if(!t&&this.allowClearColor)this.clearColor();else if(t){var i=this.getRgbaValue(t);this.setColor(i,!0,!0,!0)}else t=this.color},n.prototype.show=function(){this.openPicker()},n.prototype.hide=function(){"none"!=this.elm.picker.css("display")&&this.closePicker(null,!0)},n.prototype.save=function(){this.initialColor=this.color,this.showColorValue&&this.setInitialColorIcon(),this.embed||this.hide(),this.elm.main[0].dispatchEvent(m.save)},n.prototype.cancel=function(){this.setColorWithInitialColor(),this.embed||this.hide(),this.elm.main[0].dispatchEvent(m.cancel)},n.prototype.getRgbaValue=function(t){this.elm.rgbaColor.css("background",t);var i=this.elm.rgbaColor.css("background-color").replace(/^(rgb|rgba)\(/,"").replace(/\)$/,"").replace(/\s/g,"").split(",");return{r:parseInt(i[0]),g:parseInt(i[1]),b:parseInt(i[2]),a:i[3]?parseFloat(i[3]):1}},n.prototype.convertColor=function(t){var i=t.r,e=t.g,r=t.b,o=t.a;if(1==o||!this.allowOpacity){if("hex"==this.colorFormat)return{value:b.rgbTohex({r:i,g:e,b:r})};if("rgb"==this.colorFormat)return{value:"rgb("+i+","+e+","+r+")",r:i,g:e,b:r};if("rgba"==this.colorFormat)return{value:"rgba("+i+","+e+","+r+",1)",r:i,g:e,b:r,a:1};var s=b.rgbTohsl({r:i,g:e,b:r});return"hsl"==this.colorFormat?{value:"hsl("+s.h+","+s.s+"%,"+s.l+"%)",h:s.h,s:s.s,l:s.l}:{value:"hsla("+s.h+","+s.s+"%,"+s.l+"%,1)",h:s.h,s:s.s,l:s.l,a:1}}return"hsl"!=this.colorFormat&&"hsla"!=this.colorFormat?{value:"rgba("+i+","+e+","+r+","+o+")",r:i,g:e,b:r,a:o}:{value:"hsla("+(s=b.rgbTohsl({r:i,g:e,b:r})).h+","+s.s+"%,"+s.l+"%,"+o+")",h:s.h,s:s.s,l:s.l,a:o}};var b={rgbTohex:function(t){return("#"+("0"+parseInt(t.r,10).toString(16)).slice(-2)+("0"+parseInt(t.g,10).toString(16)).slice(-2)+("0"+parseInt(t.b,10).toString(16)).slice(-2)).toUpperCase()},rgbTohsl:function(t){var i=t.r/255,e=t.g/255,r=t.b/255,o=Math.max(i,e,r),s=Math.min(i,e,r),a=(o+s)/2,c=0,l=0;return o!=s&&(c=a<.5?(o-s)/(o+s):(o-s)/(2-o-s),l=i==o?(e-r)/(o-s):e==o?2+(r-i)/(o-s):4+(i-e)/(o-s)),a=Math.round(100*a),c=Math.round(100*c),(l=Math.round(60*l))<0&&(l+=360),{h:l,s:c,l:a}}}});